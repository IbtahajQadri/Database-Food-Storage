{% extends 'inventory/base.html' %}

{% block content %}
<div class="food-container">
    <h2>Manage Food Items</h2>
    <a href="{% url 'food' %}?action=create"><button>Create Food Item</button></a>
    <a href="{% url 'food' %}?action=modify"><button>Modify Food Item</button></a>
    <a href="{% url 'food' %}?action=delete"><button>Delete Food Item</button></a>
</div>

{% if action == 'create' %}
<div style="max-width: 600px; margin: 30px auto; border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
    <h3>Create New Food Item</h3>
    <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="submit_type" value="create_food">
        
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required value="{{ name|default:'' }}"><br><br>

        <label for="category">Select Category:</label><br>
        <select id="category" name="category_id" required onchange="document.getElementsByName('submit_type')[0].value='update_unit'; this.form.submit();">
            <option value="">-- Select Category --</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if selected_category and selected_category.id == category.id %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select><br><br>

        <label for="unit">Unit:</label><br>
        <input type="text" id="unit" name="unit" value="{% if selected_category %}{{ selected_category.unit }}{% endif %}" disabled><br><br>

        <label for="quantity">Quantity:</label><br>
        <input type="number" id="quantity" name="quantity" step="0.01" min="0" required value="{{ quantity|default:'' }}"><br><br>

        <label for="best_before">Best Before:</label><br>
        <input type="date" id="best_before" name="best_before" required value="{{ best_before|default:'' }}" min="{{ today }}"><br><br>

        <button type="submit">Create</button>
    </form>

    {% if success_message %}
        <p style="color:green;">{{ success_message }}</p>
    {% endif %}
    {% if error_message %}
        <p style="color:red;">{{ error_message }}</p>
    {% endif %}
</div>

{% elif action == 'modify' %}
<div style="max-width: 600px; margin: 30px auto; border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
    <h3>Modify Food Item</h3>
    <form method="POST" action="{% url 'food' %}?action=modify">
        {% csrf_token %}

        <label for="food_id">Select Food Item:</label><br>
        <select id="food_id" name="food_id" required onchange="this.form.submit()">
            <option value="">-- Select Food Item --</option>
            {% for item in food_items %}
                <option value="{{ item.id }}" {% if selected_food and selected_food.id == item.id %}selected{% endif %}>
                    {{ item.name }}
                </option>
            {% endfor %}
        </select><br><br>

        <label for="name">New Name:</label><br>
        <input type="text" id="name" name="name" value="{{ selected_food.name|default:'' }}" required><br><br>

        <label for="category">New Category:</label><br>
        <select id="category" name="category_id" required>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if selected_food and selected_food.category.id == category.id %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select><br><br>

        <label for="unit">Unit:</label><br>
        <input type="text" id="unit" value="{{ selected_food.category.unit|default:'' }}" disabled><br><br>

        <label for="quantity">New Quantity:</label><br>
        <input type="number" id="quantity" name="quantity" step="0.01" min="0" value="{{ selected_food.quantity|default:'' }}" required><br><br>

        <label for="best_before">New Best Before:</label><br>
        <input type="date" id="best_before" name="best_before" value="{{ selected_food.best_before|date:'Y-m-d' }}" min="{{ today }}" required><br><br>

        <button type="submit" name="submit_type" value="modify_food">Modify</button>
    </form>

    {% if success_message %}
        <p style="color:green;">{{ success_message }}</p>
    {% endif %}
    {% if error_message %}
        <p style="color:red;">{{ error_message }}</p>
    {% endif %}
</div>

{% elif action == 'delete' %}
<div style="max-width: 600px; margin: 30px auto; border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
    <h3>Delete Food Item</h3>
    <form method="POST" action="{% url 'food' %}?action=delete" onsubmit="return confirm('Are you sure you want to delete this food item?');">
        {% csrf_token %}
        <label for="food_id">Select Food Item to Delete:</label><br>
        <select id="food_id" name="food_id" required>
            <option value="">-- Select Food Item --</option>
            {% for item in food_items %}
                <option value="{{ item.id }}">{{ item.name }}</option>
            {% endfor %}
        </select><br><br>
        <button type="submit" style="background-color: red; color: white;">Delete</button>
    </form>

    {% if success_message %}
        <p style="color:green;">{{ success_message }}</p>
    {% endif %}
    {% if error_message %}
        <p style="color:red;">{{ error_message }}</p>
    {% endif %}
</div>
{% endif %}
{% endblock %}